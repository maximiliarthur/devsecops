---
name: scan-secret
description: scan secrets in code repository

runs:
  using: composite
  steps:
    - name: run scan-secret
      run: |
        /usr/bin/docker build -t zricethezav/gitleaks:v7.4.0 \
        -f "$(pwd)/actions/scan-secret/Dockerfile" "$(pwd)/actions/scan-secret"
        pwd
        /usr/bin/docker run --rm \
        -v "$(pwd)":"/github/workspace/" zricethezav/gitleaks:v7.4.0 \
        --path "/github/workspace/" \
        --redact  --config-path "/github/workspace/actions/scan-secret/gitleaks.toml" \
        --no-git --report /github/workspace/output.json \
        --leaks-exit-code=1
        ls -la

      shell: bash