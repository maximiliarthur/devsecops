---
name: scan-secret
description: scan secrets in code repository

runs:
  using: composite
  steps:
    - name: run scan-secret
      run: |

        ls -la /

        docker build -t zricethezav/gitleaks:v7.4.0 \
        -f "$(pwd)/actions/scan-secret/Dockerfile" "$(pwd)/actions/scan-secret"


        docker run --rm --mount type=bind,source=$(pwd),target=/github/workspace \
        zricethezav/gitleaks:v7.4.0 \
        --path "/github/workspace" \
        --redact  --config-path "/github/workspace/actions/scan-secret/gitleaks.toml" \
        --no-git --report /github/workspace/output.json \
        --leaks-exit-code=1
        

      shell: bash